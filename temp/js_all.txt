=====================public/js/cities.js=======================

// ----------------------------------------------
// RapidStay - ê³µí†µ ë„ì‹œ ëª©ë¡ (ì„œë²„ + í´ë¼ì´ì–¸íŠ¸ ê³µìœ )
// ----------------------------------------------
export const TARGET_CITIES = [
  // ğŸ‡°ğŸ‡· í•œêµ­
  { name: 'Seoul', display: 'ì„œìš¸' },
  { name: 'Busan', display: 'ë¶€ì‚°' },
  { name: 'Jeju', display: 'ì œì£¼' },
  { name: 'Incheon', display: 'ì¸ì²œ' },
  { name: 'Gangneung', display: 'ê°•ë¦‰' },
  { name: 'Sokcho', display: 'ì†ì´ˆ' },
  { name: 'Gyeongju', display: 'ê²½ì£¼' },
  { name: 'Yeosu', display: 'ì—¬ìˆ˜' },
  { name: 'Jeonju', display: 'ì „ì£¼' },
  { name: 'Tongyeong', display: 'í†µì˜' },

  // ğŸ‡¯ğŸ‡µ ì¼ë³¸
  { name: 'Tokyo', display: 'ë„ì¿„' },
  { name: 'Osaka', display: 'ì˜¤ì‚¬ì¹´' },
  { name: 'Kyoto', display: 'êµí† ' },
  { name: 'Fukuoka', display: 'í›„ì¿ ì˜¤ì¹´' },
  { name: 'Sapporo', display: 'ì‚¿í¬ë¡œ' },

  // ğŸ‡¹ğŸ‡­ íƒœêµ­
  { name: 'Bangkok', display: 'ë°©ì½•' },
  { name: 'ChiangMai', display: 'ì¹˜ì•™ë§ˆì´' },
  { name: 'Phuket', display: 'í‘¸ì¼“' },

  // ğŸ‡¸ğŸ‡¬ ë™ë‚¨ì•„
  { name: 'Singapore', display: 'ì‹±ê°€í¬ë¥´' },
  { name: 'Hanoi', display: 'í•˜ë…¸ì´' },
  { name: 'HoChiMinh', display: 'í˜¸ì¹˜ë¯¼' },
  { name: 'Danang', display: 'ë‹¤ë‚­' },
  { name: 'KualaLumpur', display: 'ì¿ ì•Œë¼ë£¸í‘¸ë¥´' },

  // ğŸ‡«ğŸ‡·ğŸ‡®ğŸ‡¹ğŸ‡¬ğŸ‡§ğŸ‡¨ğŸ‡­ ìœ ëŸ½
  { name: 'Paris', display: 'íŒŒë¦¬' },
  { name: 'Nice', display: 'ë‹ˆìŠ¤' },
  { name: 'Rome', display: 'ë¡œë§ˆ' },
  { name: 'Venice', display: 'ë² ë„¤ì¹˜ì•„' },
  { name: 'London', display: 'ëŸ°ë˜' },
  { name: 'Zurich', display: 'ì·¨ë¦¬íˆ' },
  { name: 'Interlaken', display: 'ì¸í„°ë¼ì¼„' },

  // ğŸ‡ºğŸ‡¸ ë¯¸êµ­
  { name: 'NewYork', display: 'ë‰´ìš•' },
  { name: 'LosAngeles', display: 'ë¡œìŠ¤ì•¤ì ¤ë ˆìŠ¤' },
  { name: 'LasVegas', display: 'ë¼ìŠ¤ë² ì´ê±°ìŠ¤' },
  { name: 'SanFrancisco', display: 'ìƒŒí”„ë€ì‹œìŠ¤ì½”' },
];


=====================public/js/common.js=======================

import { TARGET_CITIES } from "./cities.js"; // âœ… ê³µí†µ ë„ì‹œëª©ë¡ import

// ===============================
// ğŸ”§ ë„ì‹œ ì •ê·œí™” + ìŠ¬ëŸ¬ê·¸ ë³€í™˜ ìœ í‹¸
// ===============================
function normalizeKrCity(kr) {
  if (!kr) return "";
  let s = kr.trim();
  s = s
    .replace(/ëŒ€í•œë¯¼êµ­$/, "")
    .replace(/íŠ¹ë³„ì‹œ$/, "")
    .replace(/ê´‘ì—­ì‹œ$/, "")
    .replace(/ìì¹˜ì‹œ$/, "")
    .replace(/ì‹œ$/, "")
    .replace(/ë„$/, "")
    .trim();

  const map = {
    "ì„œìš¸íŠ¹ë³„ì‹œ": "ì„œìš¸",
    "ì„œìš¸ì‹œ": "ì„œìš¸",
    "ë¶€ì‚°ê´‘ì—­ì‹œ": "ë¶€ì‚°",
    "ì¸ì²œê´‘ì—­ì‹œ": "ì¸ì²œ",
    "ëŒ€êµ¬ê´‘ì—­ì‹œ": "ëŒ€êµ¬",
    "ëŒ€ì „ê´‘ì—­ì‹œ": "ëŒ€ì „",
    "ê´‘ì£¼ê´‘ì—­ì‹œ": "ê´‘ì£¼",
    "ìš¸ì‚°ê´‘ì—­ì‹œ": "ìš¸ì‚°",
    "ì œì£¼ì‹œ": "ì œì£¼",
    "ì„œê·€í¬ì‹œ": "ì œì£¼",
  };
  return map[kr] || s;
}

function toSlugFromAny(cityAny) {
  const kr = /[ê°€-í£]/.test(cityAny) ? normalizeKrCity(cityAny) : cityAny;
  const hit = TARGET_CITIES.find(
    (c) => c.display === kr || c.name.toLowerCase() === String(cityAny).toLowerCase()
  );
  return (hit ? hit.name : kr).toLowerCase();
}

// ===============================
const API_BASE_URL =
  location.hostname.includes("localhost") || location.hostname.includes("127.0.0.1")
    ? "http://localhost:8081"
    : "https://rapidstay-api.onrender.com";

// ===============================
export function initSearchBar(onSearch) {
  const cityInput = document.querySelector("#city");
  const checkInInput = document.querySelector("#checkIn");
  const checkOutInput = document.querySelector("#checkOut");
  const searchBtn = document.querySelector("#searchBtn");

  if (!cityInput || !searchBtn) {
    console.warn("ê²€ìƒ‰ë°” ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. initSearchBar ì‹¤í–‰ ì‹œì ì„ í™•ì¸í•˜ì„¸ìš”.");
    return;
  }

  // âœ… ë‚ ì§œ ê¸°ë³¸ê°’ ìë™ ì„¸íŒ…
  const today = new Date();
  const ci = new Date(today);
  ci.setDate(today.getDate() + 1);
  const co = new Date(today);
  co.setDate(today.getDate() + 2);
  const fmt = (d) => d.toISOString().split("T")[0];

  const params = new URLSearchParams(location.search);
  cityInput.value = params.get("city") || cityInput.value || "";
  if (!checkInInput.value) checkInInput.value = params.get("checkIn") || fmt(ci);
  if (!checkOutInput.value) checkOutInput.value = params.get("checkOut") || fmt(co);

  /* ======================================
     âœ… ê°ì‹¤ ì„ íƒ ë“œë¡­ë‹¤ìš´ (rooms)
     ====================================== */
  const roomBtn = document.getElementById("roomBtn");
  const dropdown = document.getElementById("roomDropdown");
  const roomSelector = document.querySelector(".room-selector");

  // âœ… ì„¸ì…˜ ì €ì¥ëœ ê°ì‹¤ ì •ë³´ ë³µì› (ìˆìœ¼ë©´ ê·¸ëŒ€ë¡œ, ì—†ìœ¼ë©´ ê¸°ë³¸ê°’)
  let rooms = [];
  try {
    const saved = JSON.parse(sessionStorage.getItem("searchRooms") || "[]");
    if (Array.isArray(saved) && saved.length > 0) {
      rooms = saved;
    } else {
      rooms = [{ adults: 2, children: 0, childAges: [] }];
    }
  } catch {
    rooms = [{ adults: 2, children: 0, childAges: [] }];
  }

  // âœ… í˜ì´ì§€ ë¡œë“œ ì‹œ ë²„íŠ¼ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
  const updateRoomBtnText = () => {
    const totalAdults = rooms.reduce((a, r) => a + r.adults, 0);
    const totalChildren = rooms.reduce((a, r) => a + r.children, 0);
    roomBtn.textContent = `ê°ì‹¤ ${rooms.length}ê°œ, ì„±ì¸ ${totalAdults}ëª…${
      totalChildren ? `, ì•„ë™ ${totalChildren}ëª…` : ""
    }`;
  };
  if (roomBtn) updateRoomBtnText();

  if (roomBtn && dropdown && roomSelector) {
    let isOpen = false;

    const openDropdown = () => {
      dropdown.style.display = "block";
      isOpen = true;
    };
    const closeDropdown = () => {
      dropdown.style.display = "none";
      isOpen = false;
    };

    // ğŸ”’ ì¤‘ë³µ ë¦¬ìŠ¤ë„ˆ ë°©ì§€
    if (window.__rsRoomsOutsideHandler) {
      window.removeEventListener("pointerdown", window.__rsRoomsOutsideHandler, true);
    }

    // âœ… ë°”ê¹¥ í´ë¦­ ì‹œ ë‹«ê¸°
    window.__rsRoomsOutsideHandler = function (e) {
      const inside = e.target.closest(".room-selector");
      if (!inside && isOpen) closeDropdown();
    };
    window.addEventListener("pointerdown", window.__rsRoomsOutsideHandler, true);

    // âœ… ë²„íŠ¼ í† ê¸€
    roomBtn.addEventListener("click", (e) => {
      e.preventDefault();
      e.stopPropagation();
      isOpen ? closeDropdown() : openDropdown();
    });

    // âœ… ë“œë¡­ë‹¤ìš´ ë‚´ë¶€ í´ë¦­ ë°©ì§€
    ["pointerdown", "mousedown", "click", "focusin", "change"].forEach((evt) => {
      dropdown.addEventListener(evt, (e) => e.stopPropagation());
    });

    dropdown.addEventListener("pointerdown", (e) => {
      if (e.target.tagName === "SELECT" || e.target.closest("select")) e.stopPropagation();
    });

    // âœ… ë Œë” í•¨ìˆ˜
    const renderRooms = () => {
      const roomList = document.getElementById("roomList");
      const wasOpen = isOpen;
      roomList.innerHTML = rooms
        .map(
          (r, i) => `
        <div class="room-item" data-index="${i}">
          <div class="room-header">ê°ì‹¤ ${i + 1}</div>
          <div class="room-row">
            <span>ì„±ì¸</span>
            <div class="counter">
              <button type="button" class="minus adult">âˆ’</button>
              <span class="count adult-count">${r.adults}</span>
              <button type="button" class="plus adult">ï¼‹</button>
            </div>
          </div>
          <div class="room-row">
            <span>ì•„ë™</span>
            <div class="counter">
              <button type="button" class="minus child">âˆ’</button>
              <span class="count child-count">${r.children}</span>
              <button type="button" class="plus child">ï¼‹</button>
            </div>
            <div class="child-ages">
              ${r.childAges
                .map(
                  (age, j) =>
                    `<select data-room="${i}" data-child="${j}">
                      ${Array.from({ length: 18 }, (_, n) =>
                        `<option value="${n}" ${n === age ? "selected" : ""}>${n}ì„¸</option>`
                      ).join("")}
                    </select>`
                )
                .join("")}
            </div>
          </div>
        </div>`
        )
        .join("");

      if (wasOpen) openDropdown();

      roomList.querySelectorAll("select").forEach((sel) => {
        ["pointerdown", "mousedown", "click", "focus"].forEach((evt) => {
          sel.addEventListener(evt, (e) => e.stopPropagation());
        });
      });
    };

    renderRooms();

    // âœ… ì¦ê° ë²„íŠ¼
    dropdown.addEventListener("click", (e) => {
      const roomEl = e.target.closest(".room-item");
      if (!roomEl) return;
      const idx = parseInt(roomEl.dataset.index, 10);

      if (e.target.classList.contains("plus")) {
        if (e.target.classList.contains("adult")) rooms[idx].adults++;
        else if (e.target.classList.contains("child")) {
          rooms[idx].children++;
          rooms[idx].childAges.push(0);
        }
      } else if (e.target.classList.contains("minus")) {
        if (e.target.classList.contains("adult") && rooms[idx].adults > 1) rooms[idx].adults--;
        else if (e.target.classList.contains("child") && rooms[idx].children > 0) {
          rooms[idx].children--;
          rooms[idx].childAges.pop();
        }
      }
      renderRooms();
    });

    // âœ… ì•„ë™ ë‚˜ì´ ì„ íƒ ë°˜ì˜ (ë‹«í˜ ë°©ì§€)
    dropdown.addEventListener("change", (e) => {
      if (e.target.tagName === "SELECT") {
        const r = parseInt(e.target.dataset.room);
        const c = parseInt(e.target.dataset.child);
        rooms[r].childAges[c] = parseInt(e.target.value);
      }
    });

    // âœ… ê°ì‹¤ ì¶”ê°€/ì‚­ì œ
    document.getElementById("addRoom")?.addEventListener("click", () => {
      rooms.push({ adults: 2, children: 0, childAges: [] });
      renderRooms();
    });
    document.getElementById("removeRoom")?.addEventListener("click", () => {
      if (rooms.length > 1) rooms.pop();
      renderRooms();
    });

    // âœ… ì ìš© ë²„íŠ¼
    document.getElementById("applyRooms")?.addEventListener("click", () => {
      closeDropdown();
      updateRoomBtnText();
      sessionStorage.setItem("searchRooms", JSON.stringify(rooms));
    });

}


// âœ… ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì‹œ
searchBtn.addEventListener("click", async (e) => {
  e.preventDefault();
  const city = cityInput.value.trim();
  const checkIn = checkInInput.value;
  const checkOut = checkOutInput.value;
  if (!city) return alert("ë„ì‹œëª…ì„ ì…ë ¥í•˜ì„¸ìš”.");

  // ğŸ‘‡ ì—¬ê¸°ê°€ í•µì‹¬
  const currentRooms = JSON.parse(JSON.stringify(rooms));
  sessionStorage.setItem("searchRooms", JSON.stringify(currentRooms));

  const payload = { city, checkIn, checkOut, rooms: currentRooms };
  const q = new URLSearchParams({ city, checkIn, checkOut }).toString();

  if (window.location.pathname.includes("/search.html")) {
    onSearch?.(payload);
  } else {
      const base = window.location.pathname.includes("/city/") ? ".." : ".";
      setTimeout(() => {
        location.href = `${base}/search.html?${q}`;
      }, 100);
  }
});

  /** ===========================
   *  ğŸ”  ìë™ì™„ì„±
   *  =========================== */
  let autoBox = document.getElementById("autocompletelist");
  if (!autoBox) {
    autoBox = document.createElement("div");
    autoBox.id = "autocompletelist";
    autoBox.className = "autocomplete-box";

    const parent = cityInput.parentElement;
    if (parent) {
      parent.style.position = "relative";
      parent.appendChild(autoBox);
    } else {
      document.body.appendChild(autoBox);
    }
  }

  let timer;
  cityInput.addEventListener("input", () => {
    const kw = cityInput.value.trim();
    if (kw.length < 2) {
      autoBox.style.display = "none";
      return;
    }
    clearTimeout(timer);
    timer = setTimeout(async () => {
      try {
        const res = await fetch(`${API_BASE_URL}/api/cities/search?query=${encodeURIComponent(kw)}`);
        const list = await res.json();
        if (!list?.length) {
          autoBox.style.display = "none";
          return;
        }

        autoBox.innerHTML = list
          .map(
            (c) => `
          <div class="auto-item" data-city="${c.city_kr || c.city_en}">
            ${c.city_kr || c.city_en}
            <span style="color:#888;font-size:13px;">${c.country || ""}</span>
          </div>`
          )
          .join("");

        autoBox.style.position = "absolute";
        autoBox.style.left = "0";
        autoBox.style.top = `${cityInput.offsetHeight + 4}px`;
        autoBox.style.width = "100%";
        autoBox.style.background = "#fff";
        autoBox.style.border = "1px solid #ccc";
        autoBox.style.borderRadius = "4px";
        autoBox.style.boxShadow = "0 2px 4px rgba(0,0,0,0.1)";
        autoBox.style.zIndex = "1000";
        autoBox.style.display = "block";
      } catch (err) {
        console.error("ë„ì‹œ ìë™ì™„ì„± ì‹¤íŒ¨:", err);
      }
    }, 300);
  });

  autoBox.addEventListener("click", (e) => {
    const item = e.target.closest(".auto-item");
    if (!item) return;
    const picked = item.dataset.city;
    cityInput.value = normalizeKrCity(picked);
    autoBox.style.display = "none";
    cityInput.focus();
  });

  /** ===========================
   *  ğŸ™ï¸ ì¸ê¸° ì—¬í–‰ì§€ ë²„íŠ¼
   *  =========================== */
  const BASE_PATH = window.location.pathname.includes("/city/") ? ".." : ".";
  document.querySelectorAll(".cityQuick").forEach((b) => {
    b.addEventListener("click", () => {
      const raw = b.dataset.city || b.textContent.trim();
      const cityName = normalizeKrCity(raw);
      const ci = new Date();
      ci.setDate(ci.getDate() + 1);
      const co = new Date();
      co.setDate(co.getDate() + 2);
      const fmt = (d) => d.toISOString().split("T")[0];
      location.href = `${BASE_PATH}/search.html?city=${encodeURIComponent(
        cityName
      )}&checkIn=${fmt(ci)}&checkOut=${fmt(co)}`;
    });
  });
}

/** ===========================
 *  ğŸ“¦ í˜¸í…” ëª©ë¡ ë Œë”ë§
 *  =========================== */
export async function fetchAndRenderHotels(city, checkIn, checkOut, roomsParam) {
  const target = document.getElementById("hotelList") || document.getElementById("hotel-list");
  if (!target) return false;

  const match = TARGET_CITIES.find(
    (c) => c.display === city || c.name.toLowerCase() === city.toLowerCase()
  );
  const slug = match ? match.name : city;
  const BASE_PATH = window.location.pathname.includes("/city/") ? ".." : ".";
  
  let hotels = [];
  let useMock = true;

  try {
    // âœ… roomsParam ìš°ì„  ì‚¬ìš©
    const storedRooms =
      roomsParam || JSON.parse(sessionStorage.getItem("searchRooms") || '[{"adults":2,"children":0,"childAges":[]}]');

    const payload = { city: slug, checkIn, checkOut, rooms: storedRooms };
    const apiRes = await fetch(`${API_BASE_URL}/api/hotels/search`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload),
    });

    if (apiRes.ok) {
      const apiData = await apiRes.json();
      if (apiData?.length) {
        hotels = apiData;
        useMock = false;
      }
    } else {
      console.warn("API ì‘ë‹µ ì‹¤íŒ¨:", apiRes.status);
    }
  } catch (e) {
    console.warn("API í˜¸ì¶œ ì‹¤íŒ¨, mock ë°ì´í„°ë¡œ ëŒ€ì²´:", e);
  }

  if (useMock) {
    try {
      const res = await fetch(`${BASE_PATH}/city-data/${slug.toLowerCase()}-top5.json`);
      const data = await res.json();
      hotels = data.topRated || [];
    } catch (e) {
      console.error("mock ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", e);
    }
  }

  if (!hotels.length) {
    target.innerHTML = "<p style='text-align:center;color:#777;'>í‘œì‹œí•  ìˆ™ì†Œê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
    return false;
  }

  target.innerHTML = hotels
    .map(
      (h) => `
    <div class="hotel-card">
      <img loading="lazy" src="${h.image || "https://picsum.photos/seed/" + h.name + "/400/250"}" alt="${h.name}">
      <div class="hotel-info">
        <h3>${h.name}</h3>
        <p>ğŸ“ ${h.address || h.city}</p>
        <p>â­ ${h.rating || "4.5"} / 5.0</p>
        <p class="price">ğŸ’° ${h.lowestPrice ? h.lowestPrice + "ì›~" : "ìš”ê¸ˆ í™•ì¸ ë¶ˆê°€"}</p>
      </div>
    </div>
  `
    )
    .join("");

  return true;
}

/** ===========================
 *  ğŸ§© Partial Loader
 *  =========================== */
export async function loadPartial(targetId, path, callback) {
  try {
    const res = await fetch(path);
    if (!res.ok) throw new Error(`Failed to load ${path}`);
    const html = await res.text();
    const el = document.getElementById(targetId);
    if (el) el.innerHTML = html;
    if (callback) callback();
  } catch (err) {
    console.error("âŒ partial load failed:", path, err);
  }
}

/** ===========================
 *  ğŸ“ city-map.json ìë™ ë¡œë“œ
 *  =========================== */
const cityMapPath = window.location.pathname.includes("/city/")
  ? "../city-data/city-map.json"
  : "./city-data/city-map.json";

fetch(cityMapPath)
  .then((res) => res.json())
  .then((list) => {
    window.citySlugMap = Object.fromEntries(
      list.map((c) => [c.display, c.name.toLowerCase()])
    );
  })
  .catch((err) => console.warn("city-map.json ë¡œë“œ ì‹¤íŒ¨:", err));


=====================public/js/home.js=======================

/**
 * RapidStay - í™ˆ ì „ìš© JS (ê²€ìƒ‰ + ì£¼ìš” ë„ì‹œ ë¯¸ë¦¬ë³´ê¸°)
 * ---------------------------------------------------
 * /public/index.html ì „ìš©
 */

import { initSearchBar } from "./common.js";

const API_BASE_URL =
  location.hostname.includes("localhost") || location.hostname.includes("127.0.0.1")
    ? "http://localhost:8081"
    : "https://rapidstay-api.onrender.com";

document.addEventListener("DOMContentLoaded", async () => {
  // âœ… 1. ì£¼ìš” ë„ì‹œ ë¯¸ë¦¬ë³´ê¸° ë¨¼ì € ë¡œë“œ
  await loadCityPreview();

  // âœ… 2. ê²€ìƒ‰ë°” ì´ˆê¸°í™”
  setTimeout(() => {
    try {
      initSearchBar();
    } catch (err) {
      console.error("ê²€ìƒ‰ë°” ì´ˆê¸°í™” ì‹¤íŒ¨:", err);
    }
  }, 100);
});

/** ===============================
 *  ğŸŒ ì£¼ìš” ë„ì‹œ ë¯¸ë¦¬ë³´ê¸°
 *  =============================== */
async function loadCityPreview() {
  const cityContainer = document.getElementById("cityContainer");
  if (!cityContainer) return;

  const cityList = [
    { name: "Seoul", display: "ì„œìš¸" },
    { name: "Busan", display: "ë¶€ì‚°" },
    { name: "Jeju", display: "ì œì£¼" },
    { name: "Tokyo", display: "ë„ì¿„" },
    { name: "Bangkok", display: "ë°©ì½•" },
    { name: "Paris", display: "íŒŒë¦¬" },
  ];

  for (const c of cityList) {
    try {
      const res = await fetch(`./city-data/${c.name.toLowerCase()}-top5.json`, { cache: "no-store" });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const data = await res.json();

      const hotels = (data.topRated || []).slice(0, 5);
      const cards = hotels
        .map(
          (h) => `
          <div class="hotel-card">
            <img src="${h.image || "https://picsum.photos/seed/" + h.name + "/400/250"}" alt="${h.name}">
            <div class="hotel-info">
              <strong>${h.name}</strong>
              <p>ğŸ“ ${h.address || h.city}</p>
              <p>â­ ${h.rating || "4.5"} / 5.0</p>
            </div>
          </div>`
        )
        .join("");

      cityContainer.insertAdjacentHTML(
        "beforeend",
        `
        <section class="city-section">
          <h3>${c.display} ì¸ê¸° ìˆ™ì†Œ</h3>
          <div class="scroll-wrapper">
            <button class="scroll-btn left">â€¹</button>
            <div class="horizontal-scroll">${cards}</div>
            <button class="scroll-btn right">â€º</button>
          </div>
          <div class="city-more">
            <a href="./city/${c.name.toLowerCase()}.html">${c.display} ì£¼ìš” ìˆ™ì†Œ ë³´ê¸° â–¶</a>
          </div>
        </section>
      `
      );
    } catch (err) {
      console.warn(`${c.display} ë¯¸ë¦¬ë³´ê¸° ë¡œë“œ ì‹¤íŒ¨:`, err);
    }
  }

  // âœ… ìŠ¤í¬ë¡¤ ë²„íŠ¼ ì´ë²¤íŠ¸
  document.querySelectorAll(".scroll-wrapper").forEach((wrap) => {
    const scrollArea = wrap.querySelector(".horizontal-scroll");
    wrap.querySelector(".scroll-btn.left")?.addEventListener("click", () => {
      scrollArea.scrollBy({ left: -300, behavior: "smooth" });
    });
    wrap.querySelector(".scroll-btn.right")?.addEventListener("click", () => {
      scrollArea.scrollBy({ left: 300, behavior: "smooth" });
    });
  });
}


=====================public/js/search.js=======================

console.log("âœ… search.js loaded");

import { initSearchBar } from "./common.js";

const API_BASE_URL =
  location.hostname.includes("localhost") || location.hostname.includes("127.0.0.1")
    ? "http://localhost:8081"
    : "https://rapidstay-api.onrender.com";

const params = new URLSearchParams(window.location.search);
const city = params.get("city") || "Seoul";
const checkIn = params.get("checkIn") || "2025-11-01";
const checkOut = params.get("checkOut") || "2025-11-03";
document.title = `${city} í˜¸í…” ê²€ìƒ‰ | RapidStay â€“ ì‹¤ì‹œê°„ ìˆ™ì†Œ ë¹„êµ`;

/* ===============================
   ğŸ” ì´ˆê¸° ë¡œë“œ
=============================== */
window.addEventListener("DOMContentLoaded", async () => {
  const mapWrapper = document.getElementById("mapWrapper");
  mapWrapper.style.display = "none";

  // âœ… header-search.html ë‚´ ê²€ìƒ‰ì°½ê³¼ ì—°ê²°
  initSearchBar(async (payload) => {
    await handleSearch(payload.city, payload.checkIn, payload.checkOut, payload.rooms);
  });

  const hasResult = await handleSearch(city, checkIn, checkOut);
  mapWrapper.style.display = hasResult ? "block" : "none";
});

/* ===============================
   ğŸ¨ ê²€ìƒ‰ í•¨ìˆ˜
=============================== */
export async function handleSearch(city, checkIn, checkOut, rooms) {
  const target = document.getElementById("hotel-list");
  target.innerHTML = "<p style='text-align:center;color:#666;'>ê²€ìƒ‰ ì¤‘...</p>";

  // âœ… ê°ì‹¤ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° (ì—†ìœ¼ë©´ ê¸°ë³¸ê°’)
  const storedRooms =
    rooms ||
    JSON.parse(sessionStorage.getItem("searchRooms") || '[{"adults":2,"children":0,"childAges":[]}]');

  const payload = {
    city,
    checkIn,
    checkOut,
    rooms: storedRooms,
  };

  try {
    const res = await fetch(`${API_BASE_URL}/api/hotels/search`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload),
    });

    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();
    const hasResult = renderHotels(data);
    return hasResult;
  } catch (err) {
    console.error("âŒ ê²€ìƒ‰ ì‹¤íŒ¨:", err);
    target.innerHTML = "<p class='empty'>í˜¸í…” ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>";
    return false;
  }
}

/* ===============================
   ğŸ–¼ï¸ ë Œë”ë§
=============================== */
function renderHotels(hotels) {
  const validHotels = hotels.filter((h) => h.id != null);
  const list = document.getElementById("hotel-list");
  const mapSection = document.getElementById("mapSection");

  if (validHotels.length === 0) {
    list.innerHTML = `<p class="empty">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
    mapSection.style.display = "none"; // ì§€ë„ ë²„íŠ¼ ìˆ¨ê¹€
    return false;
  }

  mapSection.style.display = "block"; // âœ… ê²°ê³¼ ìˆì„ ë•Œë§Œ ì§€ë„ ë²„íŠ¼ í‘œì‹œ
  list.innerHTML = validHotels
    .map(
      (h) => `
      <div class="hotel-card" data-id="${h.id}" data-expedia="${h.expediaUrl || ""}">
        <img src="https://picsum.photos/seed/${h.name}/400/250" alt="${h.name}">
        <div class="hotel-info">
          <h3>${h.name}</h3>
          <p>ğŸ“ ${h.address || h.city}</p>
          <p>â­ ${h.rating?.toFixed(1) || "4.5"} / 5.0</p>
          <p class="price">ğŸ’° ${h.lowestPrice ? `${h.lowestPrice}ì›~` : "ìš”ê¸ˆ í™•ì¸ ë¶ˆê°€"}</p>
        </div>
      </div>`
    )
    .join("");

  // ì¹´ë“œ í´ë¦­ ì´ë™ ì´ë²¤íŠ¸
  document.querySelectorAll(".hotel-card").forEach((card) => {
    card.addEventListener("click", () => {
      const expediaUrl = card.dataset.expedia || "https://www.expedia.com/";
      sessionStorage.setItem("expediaRedirectUrl", expediaUrl);
      window.location.href = "loading.html";
    });
  });

  window.currentHotels = validHotels;
  return true;
}

/* ===============================
   ğŸ—ºï¸ ì§€ë„ ëª¨ë‹¬
=============================== */
const openMapBtn = document.getElementById("openMapBtn");
const mapModal = document.getElementById("mapModal");

if (openMapBtn) {
  openMapBtn.addEventListener("click", () => {
    if (!window.currentHotels || window.currentHotels.length === 0) {
      alert("í‘œì‹œí•  ìˆ™ì†Œê°€ ì—†ìŠµë‹ˆë‹¤.");
      return;
    }
    mapModal.style.display = "flex";
    initMap();
  });
}

window.closeMap = function () {
  mapModal.style.display = "none";
};

/* ===============================
   ğŸ§­ ì§€ë„ ì´ˆê¸°í™”
=============================== */
function initMap() {
  const mapEl = document.getElementById("googleMap");
  if (!mapEl) return;

  const map = new google.maps.Map(mapEl, {
    zoom: 12,
    center: { lat: 37.5665, lng: 126.978 },
  });

  (window.currentHotels || []).forEach((hotel) => {
    if (hotel.latitude && hotel.longitude) {
      new google.maps.Marker({
        position: { lat: hotel.latitude, lng: hotel.longitude },
        map,
        title: hotel.name,
      });
    }
  });
}


==================public/script/generatecitypages.js======================
/**
 * RapidStay - ë„ì‹œë³„ ì¶”ì²œ í˜ì´ì§€ + SEO ë©”íƒ€ + êµ¬ì¡°í™” ë°ì´í„° + Sitemap ìë™ ìƒì„± (v4.2)
 * ---------------------------------------------------
 * ì‹¤í–‰: npm run generate
 */

import fs from "fs";
import path from "path";
import { fileURLToPath, pathToFileURL } from "url";

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// === ì„¤ì • ê²½ë¡œ ==========================
const TEMPLATE_PATH = "./public/templates/city-template.html";
const HEADER_PATH = "./public/partials/header-search.html";
const OUTPUT_JSON_DIR = "./public/city-data";
const OUTPUT_HTML_DIR = "./public/city";
const PUBLIC_DIR = path.join(__dirname, "../public");
const BASE_URL = "https://rapidstay-c7f8e.web.app"; // âœ… ì‹¤ì œ ë°°í¬ ê²½ë¡œ

// === cities.js ë¶ˆëŸ¬ì˜¤ê¸° ==========================
const citiesPath = path.join(__dirname, "../public/js/cities.js");
const citiesModule = await import(pathToFileURL(citiesPath).href);
const { TARGET_CITIES } = citiesModule;

// === ìœ í‹¸ ==========================
function ensureDir(dir) {
  if (!fs.existsSync(dir)) fs.mkdirSync(dir, { recursive: true });
}

// === ë”ë¯¸ ë°ì´í„° ==========================
function createDummyHotels(city) {
  return Array.from({ length: 10 }).map((_, i) => ({
    name: `${city} Hotel ${i + 1}`,
    city,
    address: `${city} ì¤‘ì‹¬ê°€ ${i + 10}ë²ˆì§€`,
    rating: (4 + Math.random() * 1).toFixed(1),
    lowestPrice: (70000 + Math.random() * 100000).toFixed(0),
    image: `https://picsum.photos/seed/${city}-${i}/400/250`,
    amenities: i % 2 === 0 ? "Family, WiFi" : "Pet Friendly, Pool",
  }));
}

// === JSON ìƒì„± ==========================
async function generateJson(city, hotels) {
  const topRated = hotels.slice(0, 5);
  const petFriendly = hotels.filter((h) => h.amenities.includes("Pet")).slice(0, 5);
  const family = hotels.filter((h) => h.amenities.includes("Family")).slice(0, 5);
  const data = { topRated, petFriendly, family };

  const jsonPath = path.join(OUTPUT_JSON_DIR, `${city.toLowerCase()}-top5.json`);
  fs.writeFileSync(jsonPath, JSON.stringify(data, null, 2));
  console.log(`ğŸ’¾ ${jsonPath} ì €ì¥ ì™„ë£Œ`);
}

// === JSON-LD ìƒì„± ==========================
function makeJsonLd(hotels, display) {
  const items = hotels.slice(0, 5).map((h, idx) => ({
    "@type": "Hotel",
    name: h.name,
    address: h.address,
    image: h.image,
    aggregateRating: {
      "@type": "AggregateRating",
      ratingValue: h.rating,
      reviewCount: Math.floor(50 + Math.random() * 200),
    },
    priceRange: `â‚©${Number(h.lowestPrice).toLocaleString()}~`,
    position: idx + 1,
  }));

  return JSON.stringify(
    {
      "@context": "https://schema.org",
      "@type": "ItemList",
      name: `${display} ì¸ê¸° í˜¸í…”`,
      itemListElement: items,
    },
    null,
    2
  );
}

// === HTML ìƒì„± ==========================
function generateHtml(city, display) {
  let template = fs.readFileSync(TEMPLATE_PATH, "utf8");

  // âœ… í—¤ë” ì¤‘ì²© ë°©ì§€ ì²˜ë¦¬ (ë‚´ë¶€ <header> ìë™ ì œê±° + BOM ì œê±°)
  let headerHTML = "<div class='fallback-header'>ğŸ¨ RapidStay Hotel Search</div>";
  if (fs.existsSync(HEADER_PATH)) {
    let rawHeader = fs.readFileSync(HEADER_PATH, "utf8");
    rawHeader = rawHeader.replace(/^\uFEFF/, ""); // BOM ì œê±°
    rawHeader = rawHeader.replace(/<\/?header[^>]*>/gi, "").trim(); // header ì œê±°
    headerHTML = rawHeader;
  }

  const canonicalUrl = `${BASE_URL}/city/${city.toLowerCase()}.html`;
  const title = `${display} í˜¸í…” ì¶”ì²œ | RapidStay`;
  const description = `${display} ì¸ê¸° í˜¸í…”, ê°€ì¡± ì—¬í–‰, ë°˜ë ¤ë™ë¬¼ ë™ë°˜ ìˆ™ì†Œ ëª¨ìŒ`;
  const imageUrl = `${BASE_URL}/assets/og/${city.toLowerCase()}.jpg`;

  const hotels = createDummyHotels(display);
  const jsonLd = makeJsonLd(hotels, display);

  template = template
    .replace(/{{cityName}}/g, display)
    .replace(/{{title}}/g, title)
    .replace(/{{description}}/g, description)
    .replace(/{{imageUrl}}/g, imageUrl)
    .replace(/{{canonicalUrl}}/g, canonicalUrl)
    .replace(/{{date}}/g, new Date().toISOString().split("T")[0])
    .replace("{{HEADER_SEARCH}}", `${headerHTML}`)
    .replace("{{HOTEL_JSON}}", jsonLd);

  const htmlPath = path.join(OUTPUT_HTML_DIR, `${city.toLowerCase()}.html`);
  fs.writeFileSync(htmlPath, template);
  console.log(`ğŸ“ ${htmlPath} ìƒì„± ì™„ë£Œ`);
}

// === sitemap.xml ìë™ ìƒì„± ==========================
function generateSitemap() {
  const htmlFiles = new Set();

  function walk(dir) {
    const files = fs.readdirSync(dir);
    for (const file of files) {
      const fullPath = path.join(dir, file);
      const stat = fs.statSync(fullPath);
      if (stat.isDirectory()) {
        walk(fullPath);
      } else if (file.endsWith(".html")) {
        const relPath = fullPath
          .replace(PUBLIC_DIR, "")
          .replace(/\\/g, "/")
          .replace(/^\/+/, "");
        htmlFiles.add(`${BASE_URL}/${relPath}`);
      }
    }
  }

  walk(PUBLIC_DIR);

  const sortedUrls = [...htmlFiles].sort();
  const now = new Date().toISOString();
  const sitemap = `<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="https://www.sitemaps.org/schemas/sitemap/0.9">
${sortedUrls
  .map(
    (url) => `
  <url>
    <loc>${url}</loc>
    <lastmod>${now}</lastmod>
    <changefreq>weekly</changefreq>
    <priority>${url.includes("/city/") ? "0.8" : "1.0"}</priority>
  </url>`
  )
  .join("")}
</urlset>`;

  const sitemapPath = path.join(PUBLIC_DIR, "sitemap.xml");
  fs.writeFileSync(sitemapPath, sitemap);
  console.log(`ğŸŒ sitemap.xml ê°±ì‹  ì™„ë£Œ (${sortedUrls.length}ê°œ URL í¬í•¨)`);
}

// === ì‹¤í–‰ ==========================
(async () => {
  ensureDir(OUTPUT_JSON_DIR);
  ensureDir(OUTPUT_HTML_DIR);

  for (const c of TARGET_CITIES) {
    const hotels = createDummyHotels(c.name);
    await generateJson(c.name, hotels);
    generateHtml(c.name, c.display);
  }

  generateSitemap();
  console.log("âœ… ëª¨ë“  ë„ì‹œ í˜ì´ì§€ ìƒì„± ë° sitemap.xml ìë™ ê°±ì‹  ì™„ë£Œ!");
  console.log(`ğŸ“ ì¶œë ¥ ê²½ë¡œ: ${path.resolve(OUTPUT_HTML_DIR)}`);
})();



===================public/seo-batch/deploytofirebase.js===================
// deployToFirebase.js
import { execSync } from "child_process";
import fs from "fs";
import path from "path";

const __dirname = path.resolve();
// ë‚ ì§œ í´ë” ì œê±° (í˜„ì¬ êµ¬ì¡°ì— ë§ì¶¤)
const src = path.join(__dirname, "seo-batch", "output");
const dest = path.join(__dirname, "public", "seo");

// 1. ê¸°ì¡´ seo í´ë” ë¹„ìš°ê¸°
fs.rmSync(dest, { recursive: true, force: true });
fs.mkdirSync(dest, { recursive: true });

// 2. output í´ë” ë‚´ íŒŒì¼ ë³µì‚¬
if (!fs.existsSync(src)) {
  console.error(`âŒ Source folder not found: ${src}`);
  process.exit(1);
}

const files = fs.readdirSync(src);
if (files.length === 0) {
  console.error(`âš ï¸ No files found in ${src}`);
  process.exit(1);
}

for (const file of files) {
  const srcPath = path.join(src, file);
  const destPath = path.join(dest, file);
  if (fs.lstatSync(srcPath).isDirectory()) {
    execSync(`cp -r "${srcPath}" "${destPath}"`);
  } else {
    fs.copyFileSync(srcPath, destPath);
  }
}

console.log("âœ… SEO í´ë” ê°±ì‹  ì™„ë£Œ");

// 3. Firebase ë°°í¬
try {
  execSync("firebase deploy --only hosting", { stdio: "inherit" });
  console.log("ğŸš€ Firebase ë°°í¬ ì™„ë£Œ");
} catch (err) {
  console.error("ë°°í¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", err.message);
}
